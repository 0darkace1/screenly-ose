// Generated by CoffeeScript 1.4.0
(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v={}.hasOwnProperty,m=function(e,t){function r(){this.constructor=e}for(var n in t)v.call(t,n)&&(e[n]=t[n]);r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e},g=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};this.screenly=(l=window.screenly)!=null?l:{};this.screenly.collections=(c=window.screenly.collections)!=null?c:{};this.screenly.views=(h=window.screenly.views)!=null?h:{};this.screenly.models=(p=window.screenly.models)!=null?p:{};this.screenly.utils=(d=window.screenly.utils)!=null?d:{};Backbone.emulateJSON=!0;o=function(e){return(new Date(e)).toISOString()};a=function(e){return(new Date(e)).toLocaleString()};f=function(e){return new Date((new Date).getTime()+e*365*24*60*6e4)};this.screenly.utils.formattedDateString=a;t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}m(t,e);t.prototype.initialize=function(e){if(this.get("asset_id"))return this.set("id",this.get("asset_id"))};t.prototype.url=function(){if(this.get("asset_id"))return"/api/assets/"+this.get("asset_id")};return t}(Backbone.Model);screenly.models.Asset=t;i=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}m(n,e);n.prototype.url="/api/assets";n.prototype.model=t;n.prototype.initialize=function(e){return this.on("reset",function(){screenly.ActiveAssets.reset();screenly.InactiveAssets.reset();return this.each(function(e){return e.get("is_active")?screenly.ActiveAssets.add(e):screenly.InactiveAssets.add(e)})})};return n}(Backbone.Collection);screenly.Assets=new i;e=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}m(n,e);n.prototype.model=t;return n}(Backbone.Collection);u=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}m(n,e);n.prototype.model=t;return n}(Backbone.Collection);screenly.collections.Assets=i;screenly.collections.ActiveAssets=e;screenly.collections.InactiveAssets=u;screenly.ActiveAssets=new e;screenly.InactiveAssets=new u;n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}m(t,e);t.prototype.initialize=function(e){return this.template=_.template($("#asset-modal-template").html())};t.prototype.events={"click #submit-button":"submitButtonWasClicked"};t.prototype.render=function(){var e,t;$(this.el).html(this.template());this.$("input.time").timepicker({minuteStep:5,showInputs:!1,disableFocus:!0,defaultTime:"current",showMeridian:!0});this.$("input.date").datepicker({autoclose:!0});if(this.model){this.$("#modalLabel").text("Edit Asset");this.$("form").attr("action","/api/assets/"+this.model.get("asset_id"));this.$("#submit-button").val("Edit Asset");this.$("input[name='name']").val(this.model.get("name"));this.$("input[name='uri']").val(this.model.get("uri"));this.$("input[name='duration']").val(this.model.get("duration"));this.$("select[name='mimetype']").val(this.model.get("mimetype"));t=new Date(this.model.get("start_date"));e=new Date(this.model.get("end_date"));this.$("input[name='start_date_date']").datepicker("update",t);this.$("input[name='end_date_date']").datepicker("update",e);this.$("input[name='start_date_time']").val(t.toLocaleTimeString());this.$("input[name='end_date_time']").val(e.toLocaleTimeString())}else{this.$("#modalLabel").text("Add Asset");this.$("input.date").datepicker("update",new Date)}return this};t.prototype.submitButtonWasClicked=function(e){var t,n;e.preventDefault();n=$("input[name='start_date_date']").val()+" "+$("input[name='start_date_time']").val();t=$("input[name='end_date_date']").val()+" "+$("input[name='end_date_time']").val();$("input[name='start_date']").val(o(n));$("input[name='end_date']").val(o(t));return this.$("form").submit()};return t}(Backbone.View);screenly.views.AssetModalView=n;s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}m(t,e);t.prototype.initialize=function(e){var t;(t=!1,g.call(e,t)>=0)&&console.log("You need to specify the template name for this AssetsView.");this.template=_.template($("#"+e.templateName).html());this.collection.bind("reset",this.render,this);this.collection.bind("remove",this.render,this);return this.collection.bind("add",this.render,this)};t.prototype.render=function(){var e=this;$(this.el).html(this.template());this.$("tbody").empty();this.collection.each(function(t){return e.$("tbody").append((new r({model:t})).render().el)});return this};return t}(Backbone.View);r=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}m(t,e);t.prototype.initialize=function(e){return this.template=_.template($("#asset-row-template").html())};t.prototype.events={"click #activation-toggle":"toggleActivation","click #edit-asset-button":"editAsset","click #delete-asset-button":"deleteAsset"};t.prototype.tagName="tr";t.prototype.render=function(){$(this.el).html(this.template(this.model.toJSON()));this.model.get("is_active")&&this.$(".toggle input").prop("checked",!0);this.$("#delete-asset-button").popover({html:!0,placement:"left",title:"Are you sure?",content:'<a href="#" id="confirm-delete" class="btn btn-large btn-danger">DELETE ASSET</a>'});return this};t.prototype.toggleActivation=function(e){var t=this;if(this.model.get("is_active")){this.model.set("end_date",(new Date).toISOString());this.model.save();return setTimeout(function(){screenly.ActiveAssets.remove(t.model);return screenly.InactiveAssets.add(t.model)},500)}this.model.set("start_date",(new Date).toISOString());this.model.set("end_date",f(10).toISOString());this.model.save();return setTimeout(function(){screenly.InactiveAssets.remove(t.model);return screenly.ActiveAssets.add(t.model)},500)};t.prototype.editAsset=function(e){var t;e.preventDefault();t=new n({model:this.model});$(this.el).append(t.render().el);return $(t.el).children(":first").modal()};t.prototype.deleteAsset=function(e){var t=this;return this.$("#confirm-delete").click(function(e){e.preventDefault();t.$("#delete-asset-button").popover("hide");return t.model.destroy()})};return t}(Backbone.View);screenly.views.AssetsView=s;jQuery(function(){var e,t;screenly.Assets.fetch();e=new s({collection:screenly.ActiveAssets,templateName:"active-assets-template"});t=new s({collection:screenly.InactiveAssets,templateName:"inactive-assets-template"});$("#active-assets-container").append(e.render().el);$("#inactive-assets-container").append(t.render().el);return $("#add-asset-button").click(function(e){var t;e.preventDefault();t=new n;$("body").append(t.render().el);return $(t.el).children(":first").modal()})})}).call(this);